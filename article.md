가변데이터에 대한 문서 자동화
======================

시작하며
-------

모양은 그대로 두고 데이터만 바꿔서 뽑아야 할 경우가 있을 것입니다.
마트에서 주는 영수증부터, 회사의 거래내역서까지,이력서 등등
각종 form등을 우리는 다운 받아 사용합니다.
테두리는 그대로고 안의 내용만 바꿉니다.
이러한 보고서 폼을 제공하는 사이트로
비즈폼
예스폼들도 있습니다.
perl과 ODF를 사용한다면, 이러한 폼들을 우리손으로 만들어 볼수도 있습니다.

준비물
-----

- OpenDocument::Template
- Catalyst


오픈도큐먼트와 함께라면
-----------

저는 ODT를 이용하여, 문서를 찍어낼 것입니다.
그러면 작업에 들어가기에 앞서
우리가 앞으로 이용하게 될 ODF,ODT에 대해서 알아봅시다.

### ODF : OpenDocumentFormat

오픈 도큐먼트 포맷(ODF)은 초기 ' 오픈오피스'에서 XML파일 포맷을 기반으로 구현한 것을
OASIS(Organization for the Advancement of Structured Information Standards) 컨소시엄이
표준화한 파일 포맷입니다.
이 포맷은 오픈 XML기반 문서 파일 포맷으로,
텍스트 문서(odt), 스프레드 시트(ods), 차트 및 그래픽 요소(odg)등에 사용 됩니다.
또 기존의 가능한 기준에 따라 간단히 변환되거나, 재사용할수 있습니다.

ODF는 XML 파일뿐만 아니라, 포함된 이미지와 같은 바이너리 파일의 컬렉션을 포함하는 ZIP 아카이브입니다.
(FIXME:ODF는 하나의 XML 문서로도 표현이 가능하지만, 일반적으로 여러개의 XML 문서와 그림과 같은 이진 파일을 하나의 zip 컨테이너 안에 묶는 형태이다. ODF 파일의 구성은 다음과 같다)
XML의 사용은 편집이 필요한 경우 간단한 텍스트 편집기로 열고 변경할 수 있기 때문에,
문서 내용에 간단히 액세스할수 있습니다.

ODF포맷을 사용한 응용 프로그램, 오피스 군으로는 다음과 같은 것들이 있습니다.

- 자유 소프트웨어
- 리버오피스
- 오픈오피스
- 애비워드
- KOffice
- 구글 오피스(Google Docs)
- 마이크로소프트 오피스 2010/Office 2007 SP2

### ODT : OpenDocumentText

즉, ODT란 오픈도큐먼트 포맷이 사용된 워드프로세서 텍스트 문서 입니다.
그럼 ODT는 어떻게 구성되어있을까요.
ODT를 포함하여 일반적인 오픈도큐먼트포맷의 파일 구성은 다음과 같습니다.

오픈오피스를 열어, 아무 글이나 작성한후 template.odt 파일로 저장한 후
unzip 유틸리티를 써서 어떤 구성으로 되어있는지 열어보았습니다.
[unzip사진]

핵심은 content.xml, meta.xml, styles.xml 같은 파일들입니다.
mimetype
문서의 MIME 타입을 기술한다.
meta.xml
문서의 메타데이터를 포함한다.
content.xml
문서의 실제 내용을 담고 있는 파일이다.
styles.xml
문서에 사용되는 스타일을 담고 있는 파일이다.
Pictures (폴더)
문서에서 사용하는 그림 파일을 담고 있는 폴더이다. 문서에서 그림을 참조할 때는 XLink 표준을 사용한다.
- meta.xml : 에는 생성 시간, 최종 수정 시간, 문서 수정 시 걸린 전체 시간, 낱말/쪽/표/그림 개수 같은 문서 메타데이터 류의 요소들이 담겨 있다. 
- styles.xml은 XML 형식으로 된 CSS 그리고 XSL-FO(XSL-Formatting Objects) 사이의 중간 정도쯤 된다고 볼 수 있다. styles.xml에는 글꼴(font), 피치(pitch), 데코레이션(decoration), 스페이싱(spacing), 탭 스톱(tab stop) 등 문서 편집 시 이용할 수 있는 다양한 스타일이 정의되어 있다. 이 스타일들은 다른 파일들이 참조하게 된다. 나중에 ODF 스타일에 대해 다룬다. 
- content.xml은 문서를 통해 실어나를 주 내용을 담고 있다. 일반적으로 텍스트, 표, 프레젠테이션 구조들이다. META-INF/manifest.xml 파일은 목차 역할을 하며 따라서 애플리케이션은 패키지에 들어있는 다른 파일들을 이 파일을 이용해 찾을 수 있다. Listing 1에 이 파일에 들어 있는 일부 내용을 보였으며 필수적이지 않은 엔트리는 뺐다.


크리스마스카드를 만들어보자.
----------------------

연말이니, 크리스마스카드나 연하장등을 만들어볼수 있을것 같습니다.
어릴 때 크리스마스 카드를 쓸 때, 처음엔 공들여서 이런저런 이야기를 쓰다가
써야할 친구들이 점차들어나면.
내용은 계속 똑같이 베껴 쓰면서 받는 친구의 이름만 바꿨던 기억이 납니다.
그럼 처음 한번만 예쁘게 카드를 꾸미고,
이름만 쓰면 크리스마스 카드가 나오게 해보면 어떨까요?
만들어 봅시다.
(네 물론, 이런 허접한 카드보다는 문구점에서 파는 카드가 더 멋지겠지만,
예를 들어서 한번만 해보자구요)

1. template.odt를 만들자.
우선 template.odt를 만들어 봅시다.
꾸미고 싶은 만큼 잔뜩 꾸밉니다.
[예시 사진]

2. 가변데이터가 될 부분을 표시하자.
위 예의 경우 받는 사람 이름이나, 날짜등은 계속 바뀔 것입니다.
네, 그것이 핵심이죠! 문서를 계속 우려서 자동생성하되, 필요한 부분의 데이터만
받아서 이용하는 것 말입니다.
그렇다면 가변데이터가 될 부분을 'xxxx'라고 표시해 봅니다.

3. unzip유틸리티를 사용하자.
그럼 이제 만들어진 template.odt를 unzip으로 분해(?)해 봅시다.
우리가 필요한 것은 위에서 설명했던 내용을 담는 파일인 content.xml과
ODF의 css인 style.xml입니다.

3-1. 팁 ONE
content.xml을 열어보면 보기 힘든 코드들이 마구 쏟아져서 어디서 수정을 해야할지 답답함을 느끼실 겁니다.
이럴 떈 $ xmltidy content.xml을 이용해서 알흠답게 코딩해보아요.
[그림]
4. 이제 아까 제가 쓴 'xxxx' 를 찾아서, 변수로 바꿔줍니다. 
[그림]
네, 있습니다. 그럼 이부분의 값만 바꿔주면, 이 안에 넣고 싶은 데로 넣을 수 있겠죠?
이 부분을 [% name %], [% date.y %]...등으로 바꿔줍니다.
5. 이제 Perl이 나설 차례입니다.
변수에 줄 값을 넣어봅니다.
예제코드
6. 완성입니다. 이제 실행만 하면 결과 ODT가 생성됩니다.
[결과 화면 + 결과 PDF]
7. Tip , 하다보면 요령이 생깁니다.
처음엔 xxxx를 찾아 변수로 바꿨는데,
애초에 [% .. %]를 써서 변수로 넣는 다면 더욱 간편하겠죵? :0
8. Template::Plugin::XML::Escape
9. 더 해보기, 표준입력으로 받는 사람 이름을 받으면 훨씬 더 수훨하게 ODT를 생성할 수 있겠죠? :)

응용해봅시다
---------

네, 그렇다면 이러한 것들을 카탈리스트 앱으로 만들면 web에서 훨씬 더 수월하게 접근할 수 있지 않을까요?
그래서 준비한 다양한 Form들 입니다.
사실 앱에 기사를 준비하는 시간의 80%를 쓴 것 같습니다 .. ㅜㅜ

## 카탈리스트 에선 어떤식으로 할까?

### Controller에서
### View단에서
### ODT 폴더에서

## 결과 예제들

직접한번해보세요 [서비스 링크]

